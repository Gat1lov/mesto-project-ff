(()=>{"use strict";var e=document.querySelector(".popup_type_edit"),t=document.querySelector(".popup__input_type_name"),n=document.querySelector(".popup_type_confirm"),r=document.querySelector(".popup_type_avatar"),o=document.getElementById("button-confirm-save"),c=document.querySelector(".popup__input_type_card-name"),u=document.querySelector(".profile__title"),i=document.querySelector(".popup__input_type_description"),a=document.querySelector(".popup__input_type_url"),s=document.querySelector(".profile__description"),d=document.getElementById("edit-profile"),l=document.querySelector(".popup_type_new-card"),p=document.getElementById("new-place"),_=document.querySelector(".places__list"),m=(document.querySelectorAll(".card"),document.querySelector(".card__delete-button"),document.querySelector(".profile__edit-button")),v=document.querySelector(".profile__add-button"),f=document.querySelector(".popup_type_image"),y=r.querySelector(".popup__button"),S=e.querySelector(".popup__close"),h=l.querySelector(".popup__close"),b=f.querySelector(".popup__close"),L=n.querySelector(".popup__close"),E=r.querySelector(".popup__close"),q=document.getElementById("button-edit-save"),g=document.getElementById("button-add-save"),k=document.getElementById("image"),C=document.getElementById("title"),x=document.getElementById("description"),I=(document.getElementById("card-image"),document.getElementById("card-title"),document.querySelector(".profile__image")),B=r.querySelector(".popup__input_avatar"),j=r.querySelector(".pop-up__error-message"),T=document.getElementById("button-avatar-save"),A={baseUrl:"https://nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"3a6a22df-0b86-4e1d-82b6-49402f2e54e3","Content-Type":"application/json"}};function U(e,t,n){return e.length>=t&&e.length<=n}function w(e,t,n){n?(e.classList.add("popup__input_error"),t.textContent=n):(e.classList.remove("popup__input_error"),t.textContent="")}function N(){var e=t.value.trim(),n=i.value.trim(),r=U(e,2,40),o=U(n,2,200);q.disabled=!(r&&o),w(t,document.getElementById("input-name-error"),r?"":"Имя должно быть от 2 до 40 символов"),w(i,document.getElementById("input-job-error"),o?"":"Род деятельности должен быть от 2 до 200 символов")}function P(e){throw new TypeError('"'+e+'" is read-only')}function O(){var e=c.value.trim(),t=a.value.trim(),n=e.length>=2&&e.length<=30,r=J(t),o=n&&r;g.disabled=!o,D(n,c,"#input-add-error","Название должно быть от 2 до 30 символов"),D(r,a,"#input-url-error","Введите корректный URL")}function J(e){try{var t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}}function D(e,t,n,r){var o=document.querySelector(n);e?(t.classList.remove("popup__input_error"),o.textContent=""):(t.classList.add("popup__input_error"),o.textContent=r)}function R(){var e=B.value.trim();/^(ftp|http|https):\/\/[^ "]+$/.test(e)?(j.textContent="",B.classList.remove("popup__input_error"),y.removeAttribute("disabled")):(j.textContent="Введите корректный URL",B.classList.add("popup__input_error"),y.setAttribute("disabled",!0))}function V(e){var t=e.currentTarget;e.target===t&&(document.removeEventListener("keydown",F),z(t))}function F(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&z(t)}}function H(e){document.addEventListener("keydown",F),e.classList.add("popup_is-opened")}function z(e){document.removeEventListener("keydown",F),e.classList.remove("popup_is-opened")}q.disabled=!0,d.addEventListener("submit",(function(e){e.preventDefault();var n=t.value.trim(),r=i.value.trim(),o=document.querySelector("#input-name-error"),c=document.querySelector("#input-job-error");o.textContent="",c.textContent="";var u=U(n,2,40),a=U(r,2,200);w(t,o,u?"":"Имя должно быть от 2 до 40 символов"),w(i,c,a?"":"Род деятельности должен быть от 2 до 200 символов"),q.disabled=!(u&&a)})),t.addEventListener("input",N),i.addEventListener("input",N),p.addEventListener("submit",(function(e){e.preventDefault();var t=c.value.trim(),n=a.value.trim(),r=document.querySelector("#input-add-error"),o=document.querySelector("#input-url-error");r.textContent="",o.textContent="",t.length<2||t.length>30?(r.textContent="Название должно быть от 2 до 30 символов",P("popupAddNewCardFormValidation"),c.classList.add("popup__input_error")):c.classList.remove("popup__input_error"),J(n)?a.classList.remove("popup__input_error"):(o.textContent="Введите корректный URL",P("popupAddNewCardFormValidation"),a.classList.add("popup__input_error")),g.disabled=!1})),g.disabled=!0,c.addEventListener("input",O),a.addEventListener("input",O),B.addEventListener("input",R),I.addEventListener("click",(function(){R(),H(r)})),m.addEventListener("click",(function(){t.value=u.textContent,i.value=s.textContent,N(),H(e)})),v.addEventListener("click",(function(){O(),H(l)})),S.addEventListener("click",(function(){z(e)})),h.addEventListener("click",(function(){z(l)})),b.addEventListener("click",(function(){z(f)})),L.addEventListener("click",(function(){z(n)})),E.addEventListener("click",(function(){z(r)})),e.addEventListener("click",V),l.addEventListener("click",V),f.addEventListener("click",V),n.addEventListener("click",V),r.addEventListener("click",V);var G=document.querySelector(".popup__caption"),M=document.querySelector("#card-template");function $(e,t){var n=document.querySelector(".popup_type_image"),r=n.querySelector(".popup__image");r.src=t,r.setAttribute("alt",e),G.textContent=e,H(n)}function K(e){fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:"Жак-Ив Кусто",about:"Эксперт по океанам"})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return C.textContent=e.name,x.textContent=e.about,k.style.backgroundImage=e.avatar,e._id})).then((function(t){e.forEach((function(e){var r=function(e,t,n,r,o,c){var u=M.content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__title"),a=u.querySelector(".card__image"),s=u.querySelector(".card__like-button"),d=u.querySelector(".card__like-numbers");return i.textContent=e,a.src=t,a.alt=e,d.textContent=n.length,s.addEventListener("click",(function(){r(s,c)})),a.addEventListener("click",(function(){o(e,t)})),u}(e.name,e.link,e.likes,Q,$,e._id),o=e.owner._id;t===o?function(e,t){e.querySelector(".card__delete-button").addEventListener("click",(function(){H(n),function(e){fetch("".concat(A.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t)}))}(r,e._id):function(e){e.querySelector(".card__delete-button").style.display="none"}(r),(JSON.parse(localStorage.getItem("likes"))||{})[e._id]&&r.querySelector(".card__like-button").classList.add("card__like-button_is-active"),_.appendChild(r)}))})).catch((function(e){console.error("Error rendering cards:",e)}))}function Q(e,t){var n=e.parentElement.querySelector(".card__like-numbers");e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){var n=JSON.parse(localStorage.getItem("likes"))||{};return delete n[e],localStorage.setItem("likes",JSON.stringify(n)),t}))}(t).then((function(){e.classList.remove("card__like-button_is-active");var t=parseInt(n.textContent,10);n.textContent=t-1})):function(e){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){var n=JSON.parse(localStorage.getItem("likes"))||{};return n[e]=!0,localStorage.setItem("likes",JSON.stringify(n)),t}))}(t).then((function(){e.classList.add("card__like-button_is-active");var t=parseInt(n.textContent,10);n.textContent=t+1}))}o.addEventListener("click",(function(){o.textContent="Удаляем...",setTimeout((function(){o.textContent="Да",z(n),location.reload()}),1e3)})),fetch("".concat(A.baseUrl,"/cards"),{method:"GET",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).then((function(e){K(e)})).catch((function(e){console.log(e)})),function(e){function t(t,n){n.disabled=!t.checkValidity(),n.disabled?n.classList.add(e.inactiveButtonClass):n.classList.remove(e.inactiveButtonClass)}function n(n){Array.from(n.querySelectorAll(e.inputSelector)).forEach((function(n){n.addEventListener("input",(function(){!function(n){var r=n.closest(e.formSelector);!function(t,n){n.validity.valid?function(t,n){var r=t.querySelector("#".concat(n.name,"-error"));r&&(n.classList.remove("popup__input_error"),r.textContent="",r.classList.remove(e.errorClass))}(t,n):function(t,n){var r=t.querySelector("#".concat(n.name,"-error"));r&&(n.classList.add("popup__input_error"),r.textContent=n.validationMessage,r.classList.add(e.errorClass))}(t,n)}(r,n);var o=r.querySelector(e.submitButtonSelector);t(r,o)}(n)}))})),n.addEventListener("submit",(function(e){e.preventDefault()})),t(n,n.querySelector(e.submitButtonSelector))}document.querySelectorAll(e.formSelector).forEach((function(e){n(e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error"}),d.addEventListener("submit",(function(n){n.preventDefault(),u.textContent=t.value,s.textContent=i.value,q.textContent="Сохранение...",setTimeout((function(){q.textContent="Сохранить",e.classList.remove("popup_is-opened")}),1e3)})),y.addEventListener("click",(function(e){var t=B.value.trim();T.textContent="Сохранение...",function(e){return fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){I.style.backgroundImage="url(".concat(e,")")}))}(t).then((function(e){setTimeout((function(){T.textContent="Сохранить",I.style.backgroundImage="url(".concat(t,")"),z(r)}),1e3)}))})),p.addEventListener("submit",(function(e){e.preventDefault();var t,n=p.querySelector(".popup__input_type_card-name").value,r=p.querySelector(".popup__input_type_url").value;g.textContent="Создание...",(t={name:n,link:r},fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){setTimeout((function(){g.textContent="Создать",z(l),location.reload()}),1e3)}))}));var W=document.querySelector(".popup_type_image"),X=W.querySelector(".popup__image"),Y=W.querySelector(".popup__close"),Z=W.querySelector(".popup__caption");Y.addEventListener("click",(function(){z(W),X.setAttribute("src",""),X.setAttribute("alt",""),Z.textContent=""}))})();